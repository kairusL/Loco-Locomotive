using UnityEngine;

public class DispenserObject : MonoBehaviour
{
    [SerializeField] private DestroyOnDelay _delayOnDestroy = null;
    [SerializeField] private SpriteRenderer _spriteRenderer = null;
    [SerializeField] private DispenserData.Type type = default;
    [SerializeField] private Color color = default;

    public SpriteRenderer Sprite { get { return _spriteRenderer; } }
    public DispenserData.Type ObjectType { get { return type; } set { type = value; } }
    public Color ObjectColor { get { return color; } set { color = value; } }

    public TurretRepair turretRepair;
    public TurretLoader turretLoader;
    public FireBox fireBox;
    public ItemIndicator itemIndicator;

    public void StartDestructionTimer()
    {
        if (_delayOnDestroy)
        {
            _delayOnDestroy.BeginTimer();
        }
    }

    private void OnTriggerEnter2D(Collider2D collision)
    {
        if (collision.CompareTag("Player"))
        {
            Player player = collision.GetComponent<Player>();
            if (!player)
            {
                Debug.LogError($"Item failed to find player");
                return;
            }
            player.dispenserObject = this;
        }
    }

    private void OnTriggerExit2D(Collider2D collision)
    {
        if (collision.CompareTag("Player"))
        {
            Player player = collision.GetComponent<Player>();
            if (!player)
            {
                Debug.LogError($"Item failed to find player");
                return;
            }
            player.dispenserObject = null;


        }
    }

    public void OnBecameInvisible()
    {
        Destroy(this.gameObject);
    }
}